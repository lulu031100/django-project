{% extends "base/app.html" %}
{% block contents %}
<div class="center-block container col-8 offset-2">
    <main>
    <h2>写真登録</h2>
    <form id="postsnewform" action="{% url 'posts:new' %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
           <label for="text">ユーザー</label>
            {{ form.author}}
        </div>
        <div class="form-group">
              <label for="text">サロン</label>
            {{ form.salon}}
            {% if form.salon.errors %}
            </div>
            <div class="alert alert-danger">
                {{ form.salon.errors }}
            </div>
            {% endif %}
        </div>
        <div class="form-group">
              <label for="text">美容師</label>
            {{ form.adviser}}
        </div>
        <div class="form-group">
            <div class="selectpict">
            {{ form.picture}}
            {% if form.picture.errors %}
            </div>
            <div class="alert alert-danger">
            {{ form.picture.errors }}
            </div>
            {% endif %}
            <div class="selectpict">
            {{ form.picture2}}
            {% if form.picture2.errors %}
            </div>
            <div class="alert alert-danger">
                {{ form.picture2.errors }}
            </div>
            {% endif %}
            <div class="selectpict">
            {{ form.picture3}}
            {% if form.picture3.errors %}
            </div>
            <div class="alert alert-danger">
                {{ form.picture3.errors }}
            </div>
            {% endif %}
        </div>
        <div class="form-group">
            <label for="text">メッセージ</label>
            <textarea class="form-control" name="text" cols="40" rows="10" id="id_text"></textarea>
            {% if form.text.errors %}
            <div class="alert alert-danger">
                {{ form.text.errors }}
            </div>
            {% endif %}
        </div>
        <div class="form-group">
              <label for="text">日付</label>
            {{ form.created_at}}
        </div>
<!--        <div class="form-group">-->
<!--            <input type="submit" value="投稿" fileclass="btn btn-primary form-control">-->
<!--        </div>-->
      <div class="btn-group">
            <span class="mgr-10"><input type="submit" value="投稿" class="btn btn-pink w-300px form-control"></span>
            <input type="button" value="戻る" onClick="javascript:history.go(-1);" class="btn btn-pink mr-10 w-300px form-control">
        </div>
        <div> {{form.media }} </div>
    </form>
</main>
</div>
{% endblock contents %}
{% block extrajs %}
    <script>
        const salonElement = document.getElementById('id_salon');
        const adviserElement = document.getElementById('id_adviser');

        const changeCategory = (select) => {
            // 子カテゴリの選択欄を空にする。
            categoryElement.innerHTML = '';

            const pk = salonElement[salonElement.selectedIndex].value;
            const url = `{% url 'posts:ajax_get_adviser' %}?pk=${pk}`;

            fetch(url)
                .then(response => {
                    return response.json();
                })
                .then(response => {
                    for (const adviser of response.adviserList) {
                        const option = document.createElement('option');
                        option.value = adviser.pk;
                        option.innerHTML = adviser.name;
                        adviserElement.add(option);
                    }

                    if (select !== undefined) {
                        for (let i = 0, len = adviserElement.length; i < len; i++) {
                            const option = adviserElement[i];
                            if (option.value === select) {
                                option.selected = true;
                            }
                        }
                    }

                })
                .catch(error => {
                    console.log(error)
                });
        };

        salonElement.addEventListener('change', () => {
            changeAdviser();
        });

        // 入力値に問題があって再表示された場合、ページ表示時点で小カテゴリが絞り込まれるようにする
        if (salonElement[salonElement.selectedIndex].value) {
            const selectedAdviser = adviserElement[adviserElement.selectedIndex].value;
            changeAdviser(selectedAdviser);
        }
    </script>

{% endblock %}